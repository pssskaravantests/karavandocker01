- route:
    id: route-e2f2
    nodePrefixId: route-dc2
    from:
      id: from-bbdd
      description: Internal Route
      uri: direct
      parameters:
        name: internal-route
      steps:
        - process:
            id: process-25ad
            description: Extract SSF Identificator from Body
            ref: CustomProcessor
        - setProperty:
            id: setProperty-e434
            description: Client Credentials Segment
            name: clientCredentials
            expression:
              simple:
                id: simple-47a8
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.clientCredentials}
                resultType: java.lang.String
        - setProperty:
            id: setProperty-e435
            description: Token URL Segment
            name: tokenUrl
            expression:
              simple:
                id: simple-47a9
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.tokenUrl}
                resultType: java.lang.String
        - setProperty:
            id: setProperty-e436
            description: Company Credentials Segment
            name: companyCredentials
            expression:
              simple:
                id: simple-47a0
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.companyCredentials}
                resultType: java.lang.String
        - to:
            id: to-b1e5
            description: Log Properties
            uri: log
            parameters:
              showProperties: true
              loggerName: properties-logger
        - script:
            id: script-3ec8
            description: Set Body as concatenation of ClientID + TokenURL
            expression:
              groovy:
                id: groovy-a095
                expression: >-
                  // Obtener el valor de la propiedades: tokenUrl y
                  clientCredentials

                  def clientCredentials =
                  exchange.getProperty('clientCredentials')

                  def tokenUrl = exchange.getProperty('tokenUrl')


                  // asegurar el valor de la cabecera Content-Type

                  exchange.setProperty('Content-Type',
                  'application/x-www-form-urlencoded')


                  // Establecer el cuerpo (body) del mensaje como concatenaciÃ³n
                  de clientCredentials y tokenURL

                  exchange.getIn().setBody(clientCredentials + '&' + tokenUrl)
        - log:
            id: log-1123
            description: Show Body content
            message: ${body}
        - to:
            id: to-9c12
            description: Get ASSERTION data
            uri: https
            pattern: InOut
            parameters:
              httpUri: https://api12preview.sapsf.eu/oauth/idp
              method: POST
              contentType: application/x-www-form-urlencoded
              disableStreamCache: true
              connectionClose: true
              skipResponseHeaders: true
        - setProperty:
            id: setProperty-7065
            description: Set Fake Body With Groovy
            name: set-fake-response-body
            expression:
              groovy:
                id: groovy-c51c
                expression: >-
                  exchange.getIn().setBody("{\"access_token\":\"eyJ0b2tlbkNvbnRlbnQiOnsiYXBpS2V5IjoiWVdRellUUm1Oell6WkdFeU9HSmpOVFJoTldVNVltVTBORFk0TlEiLCJzZlByaW5jaXBsZSI6ImFkbWlubnR0ZW1lYWwjRElWI0MwMDA5NDE3NDkxVDEiLCJpc3N1ZWRGb3IiOiJTRlNGTG9jYWxSb21hbmlhVDFfRUhVQlQxIiwic2NvcGUiOiIiLCJpc3N1ZWRBdCI6MTcyODczNDkwNTYxMSwiZXhwaXJlc0F0IjoxNzI4ODIxMzA1NjExfSwic2lnbmF0dXJlIjoiYjRuN3hLUzFDVXVYMmtwN2JMSUdCSkpCQ0tBK1M1N1A5QjNDODR0YzdsVUl3akthZE9nSm1ZTkF1V1VPMitxaGVYY3FKQVVKVERZUWxxUlBlTDhxL1I4NXpwMGRObk1JSjJORzhWbk12UnUxV202STFBSlVTV3JlZy9xa2Nwam54Y2VlU1ZLb2tVanIxMjlaZjA5Qk1ZelNFRi92V3MvTVNaOCs3T1JTUTYwPSJ9\",\"token_type\":\"Bearer\",\"expires_in\":86399}")
