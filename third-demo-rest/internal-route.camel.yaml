- route:
    id: route-e2f2
    nodePrefixId: route-dc2
    from:
      id: from-bbdd
      description: Internal Route
      uri: direct
      parameters:
        name: internal-route
      steps:
        - process:
            id: process-25ad
            description: Extract SSF Identificator from Body
            ref: CustomProcessor
        - setProperty:
            id: setProperty-e434
            description: Client Credentials Segment
            name: clientCredentials
            expression:
              simple:
                id: simple-47a8
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.clientCredentials}
                resultType: java.lang.String
        - setProperty:
            id: setProperty-e435
            description: Token URL Segment
            name: tokenUrl
            expression:
              simple:
                id: simple-47a9
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.tokenUrl}
                resultType: java.lang.String
        - setProperty:
            id: setProperty-e436
            description: Company Credentials Segment
            name: companyCredentials
            expression:
              simple:
                id: simple-47a0
                expression: >-
                  ${properties:${exchangeProperty.selectedSSFIdentificator}.companyCredentials}
                resultType: java.lang.String
        - to:
            id: to-b1e5
            description: Log Properties
            uri: log
            parameters:
              showProperties: true
              loggerName: properties-logger
        - script:
            id: script-3ec8
            description: Set Body as concatenation of ClientID + TokenURL
            expression:
              groovy:
                id: groovy-a095
                expression: >-
                  // Obtener el valor de la propiedades: tokenUrl y
                  clientCredentials

                  def clientCredentials =
                  exchange.getProperty('clientCredentials')

                  def tokenUrl = exchange.getProperty('tokenUrl')


                  // asegurar el valor de la cabecera Content-Type

                  exchange.setProperty('Content-Type',
                  'application/x-www-form-urlencoded')


                  // Establecer el cuerpo (body) del mensaje como concatenaciÃ³n
                  de clientCredentials y tokenURL

                  // String bodyContent = clientCredentials + "&" + tokenUrl

                  String bodyContent =
                  "client_id=YWQzYTRmNzYzZGEyOGJjNTRhNWU5YmU0NDY4NQ&user_id=adminnttemeal&token_url=https://api12preview.sapsf.eu/oauth/token&private_key=TUlJRXZnSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2d3Z2dTa0FnRUFBb0lCQVFEaU1MVVF0Rnp4bXduQ2VHWFFKNUVDS1VKNG91T0FjTnVlNm52TExUSlBRWGZzUTJ6TUhHU0xudy8vYy9ldERVMVI5bTNXTmd3cXRvY0Q5Sjg5R01nSU8wZEVHQWwvV25TSlp1YzZicGVVcThtR2tyTE5pUXA4TzAxMUsrU01qVVJyV1RTM2tPUUhRdzZHTmFsRVFwc0xLaGJBNDBNRUtDUEY3Y1VCcFBHTlRSNWNvWEVUb21xN1czeVdmQjc2VXQyTVk3U3NZUjNheXQrZlBwazFXc1F5dzZNalovM1V0UTN1ekZwMHIvT3BldnJtZndoREowclB2N3ByVWErZ3J2cGNuMnRNb2Z6K3NXUWU5WWErLzFKVFJRSVZmYlZDbGhWNTRNTW9CcWprNUMyUXBicFhGRmlLRXNTeGx6OFlBZ1FlNjVHOWlLNXJDUmc3OS84ZllqeTNBZ01CQUFFQ2dnRUFIQ3cxUHBXUWZBd0pBbFFOQTdPM1A5M1VFeTJLczVmd1ZaSUpoWmJRRE56RkswUXNwc2I1NDdBV0Jkc3p1V0M0OERheG16dytkZ3JTWDBwQlBwSzV4aTRIK1ljYTY3dGdYTnJZZmNmWGtTTjMwRG9HYVBaTmtZZ0dENkdUYjhtS3E1VHFyWVhhVG1pVTd3b21WcGtMTWEvMk1lUG5RdEJ6Rll5V0oxY2NPbDArMTlmYXZNcHpyUnc0dkRseEhkRWhzdUhHcHJwcTdHN2xBSHI1azYvNHVIMFRxSDhwU3g3SldlZzNJZkQvOEJEYk5lVThyQkF3K2xscjkyVE5ieDBlMC9RblZ5M0UzanE1WElsSE8wL3FySzZRaDhwOVdzREQwUFdaNjh1T1ZRbHVNcGRhRFNtRDVsS1BsMFN0ekZ4VjZVbXorVnlSL3dLUFVQdFREUTJYMVFLQmdRRHA3cHRUNjRVZzd0UHl4NW9lbmc4bUVkZDJ4aTRnVVZLclFMTmVUY3VaV2h0b05NOXZ5WG9GR0tMZlo0T1pBVy9qaE1TOEVQWFlNVWIvS3I5aVpvNWJpVW94Nk0vSWVkVjRFUmdMRHA5WG5xSmM4bTdHVm01a0QwY1JLYTNsWEhaMVBVNmFGc2NPS01vRkkzTWJOTFViOHRLVlFHUllvdWw5dDJKWFRuc3Z2UUtCZ1FEM2h5TnNqMU10MlRsQ1hOeW93Ni8vWVU3Rm16Qzg3OGcvTFdWSk1mUHJhZE4vM05YUGpnV2JDSWd4RHlVWHE4d3BKVHpxdFpwUWliLzdBQ2JFbDVnS3puNUxJcXRIVks5R29sZXlSV2FmaUw5bHBRS05JOEZxVHFqamR1N2JVVjF1UlFCVC8xcms4M2VpL0NJOFNUaTdtOU05ZlRRSk93cVF1MVVZdGgxN2d3S0JnRzZYdmxrclJESHdsc1QxTmxoNU13STFkeDZRektlOHFvK0p0QUxHVnBXMk1yVE9HcTlubWNjbEFZTUtoZjFrMzRlNWNlVFRROWFrWFVNdTYzSFN1RVJ3SUdKK0JSVnErOCthalRwVS9HSEkva3RnMVp2d3FwbWxXMXl5enFKYlZ5bFFCWVAxZHIrcjZ1NEk5MWNLVVFEWWlGUEZNR3R6QVYzTXY3STB5U29sQW9HQkFOUTllYkJpREk1cGplRkxRcUVxZWNSZUtXN2lySjIwZEYxSGpXdC9lNGpGaXVZOThzOHZGYnRqUzNQVmFwYXJaamw1aG93eC93bERzK3VDcTdzeHlOcXJTRHNnbFFCcXFvZkVON0hTTkRaaXlNcGMvSjBNcFpHRHRPaWxXQldSNUt6aVdXK3Nxc0ZaeWFGazArNGhVcFg2L052aWVUWFkvQ3d4bEx2Rm0rNEZBb0dCQUl4VC9hSWtGc1d0b2ZhN2JxRlJ4QzlvNFl3OG00RFpLTGhKeU9mNlpyWHlSVkgxellBM294R2xWZlVVRUtaSk4wWHRpaUJXd0VMZk5MTVZCbFE2VTRFZy81ektTNDUvWGxOMFJyS3BSUjNld2NTRVgwaitzTDJjeHkrb3Fsd0tJYzlhZWY4VWdCK3hmZGdMdGxQeTBmZUlERER3MGZCSXVuUkJaWGU3MGh0YyMjI0MwMDA5NDE3NDkxVDE="

                  exchange.getIn().setBody(bodyContent)
        - to:
            id: to-3b4e
            description: Log Properties and Body Content
            uri: log
            parameters:
              loggerName: log-data-before-post-1
              showAllProperties: false
              showCachedStreams: false
        - to:
            id: to-9c12
            description: Get ASSERTION data
            uri: https
            pattern: InOut
            parameters:
              httpUri: api12preview.sapsf.eu/oauth/idp
              disableStreamCache: true
              connectionClose: true
              skipResponseHeaders: true
              bridgeEndpoint: true
              httpMethod: POST
        - to:
            id: to-3b4a
            description: Log Properties and Body Content
            uri: log
            parameters:
              loggerName: log-data-before-post-2
              showAllProperties: true
        - setProperty:
            id: setProperty-7065
            description: Set Fake Body With Groovy
            name: set-fake-response-body
            expression:
              groovy:
                id: groovy-c51c
                expression: >-
                  exchange.getIn().setBody("{\"access_token\":\"eyJ0b2tlbkNvbnRlbnQiOnsiYXBpS2V5IjoiWVdRellUUm1Oell6WkdFeU9HSmpOVFJoTldVNVltVTBORFk0TlEiLCJzZlByaW5jaXBsZSI6ImFkbWlubnR0ZW1lYWwjRElWI0MwMDA5NDE3NDkxVDEiLCJpc3N1ZWRGb3IiOiJTRlNGTG9jYWxSb21hbmlhVDFfRUhVQlQxIiwic2NvcGUiOiIiLCJpc3N1ZWRBdCI6MTcyODczNDkwNTYxMSwiZXhwaXJlc0F0IjoxNzI4ODIxMzA1NjExfSwic2lnbmF0dXJlIjoiYjRuN3hLUzFDVXVYMmtwN2JMSUdCSkpCQ0tBK1M1N1A5QjNDODR0YzdsVUl3akthZE9nSm1ZTkF1V1VPMitxaGVYY3FKQVVKVERZUWxxUlBlTDhxL1I4NXpwMGRObk1JSjJORzhWbk12UnUxV202STFBSlVTV3JlZy9xa2Nwam54Y2VlU1ZLb2tVanIxMjlaZjA5Qk1ZelNFRi92V3MvTVNaOCs3T1JTUTYwPSJ9\",\"token_type\":\"Bearer\",\"expires_in\":86399}")
